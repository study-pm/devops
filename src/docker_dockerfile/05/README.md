# Lab #5 : Create an image with ENTRYPOINT instruction
https://dockerlabs.collabnix.com/beginners/dockerfile/Dockerfile-ENTRYPOINT.html

- [Overview](#overview)
- [Assignment](#assignment)
- [Command Line Tools](#command-line-tools)
  - [Start the service](#start-the-service)
  - [Stop the service](#stop-the-service)
  - [Underlying commands](#underlying-commands)
    - [Pre-requisite](#pre-requisite)
    - [Create an image with `ENTRYPOINT` instruction(Exec Form)](#create-an-image-with-entrypoint-instructionexec-form)
      - [Create Dockerfile](#create-dockerfile)
      - [Building Docker Container](#building-docker-container)
      - [Verify the Image](#verify-the-image)
      - [Create a container](#create-a-container)
    - [`ENTRYPOINT` instruction in Shell Form](#entrypoint-instruction-in-shell-form)
      - [Create Dockerfile](#create-dockerfile-1)
      - [Build Docker Image](#build-docker-image)
      - [Verify the Image](#verify-the-image-1)
      - [Create a container](#create-a-container-1)
      - [Override the existing `ENTRYPOINT`](#override-the-existing-entrypoint)
- [Utils / Trivia](#utils--trivia)
  - [Exit the container shell](#exit-the-container-shell)
- [Troubleshooting](#troubleshooting)
  - [Fix `permission denied` error](#fix-permission-denied-error)
  - [Fix `failed to read dockerfile` error](#fix-failed-to-read-dockerfile-error)

## Overview
The `ENTRYPOINT` instruction make your container run as an executable.
`ENTRYPOINT` can be configured in two forms:

- **Exec Form**

    ```docker
    ENTRYPOINT [“executable”, “param1”, “param2”]
    ```

- **Shell Form**

    ```docker
    ENTRYPOINT command param1 param2
    ```

If an image has an `ENTRYPOINT` if you pass an argument it, while running container it wont override the existing entrypoint, it will append what you passed with the entrypoint.To override the existing `ENTRYPOINT` you should user `--entrypoint` flag when running container.

## Assignment
- Create an image with `ENTRYPOINT` instruction(Exec Form)
- `ENTRYPOINT` instruction in Shell Form
- Override the existing `ENTRYPOINT`

## Command Line Tools
There are two prime commands for managing (starting and stopping) the provided service.

### Start the service
The following command runs the full command sequence:
```sh
$ ./start
```

alternatively:
```sh
$ sh start
```

### Stop the service
The following command clears all of the output (removing all possible side-effects) generated by running the *start* command:
```sh
$ ./clear
```

alternatively:
```sh
$ sh clear
```

### Underlying commands
There are multiple underlying scripts used for building the service functions. The sections below describe the commands used for managing the provided service and building the necessary resources.

#### Pre-requisite
There should be the following files (committed) in your working directory:
- *build1.Dockerfile*
- *build2.Dockerfile*

In case any of them missing, run the *[create.sh](./create.sh)* script before executing the *start* command.

#### Create an image with `ENTRYPOINT` instruction(Exec Form)

##### Create Dockerfile
*Dockerfile*
```docker
FROM alpine:3.5
LABEL maintainer="Collabnix"

ENTRYPOINT ["/bin/echo", "Hi, your ENTRYPOINT instruction in Exec Form !"]
```

Placed into *[create.sh](./create.sh)*.

##### Building Docker Container
```sh
$ docker build -t ajeetraina/lab3_cmd . -f Dockerfile_cmd
```

Placed into *[build.sh](./build.sh)*.

##### Verify the Image
```sh
$ docker image ls

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
entrypoint          v2                  cde521f13080        2 minutes ago       4MB
entrypoint          v1                  1d06f06c2062        5 minutes ago      4MB
alpine              3.5                 f80194ae2e0c        7 months ago        4MB
```

Placed into *[verify.sh](./verify.sh)*.

##### Create a container
```sh
$ docker run ajeetraina/lab3_cmd:latest
```

Placed into *[run.sh](./run.sh)*.

#### `ENTRYPOINT` instruction in Shell Form

##### Create Dockerfile
*Dockerfile*:
```docker
$ cat Dockerfile
FROM alpine:3.5
LABEL maintainer="Collabnix"

ENTRYPOINT echo "Hi, your ENTRYPOINT instruction in Shell Form !"
```

Placed into *[create.sh](./create.sh)*.

##### Build Docker Image
```sh
$ docker build -t entrypoint:v2 .
```

Placed into *[build.sh](./build.sh)*.

##### Verify the Image
```sh
$ docker image ls

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
entrypoint          v2                  cde521f13080        2 minutes ago       4MB
entrypoint          v1                  1d06f06c2062        5 minutes ago      4MB
alpine              3.5                 f80194ae2e0c        7 months ago        4MB
```

Placed into *[verify.sh](./verify.sh)*.

##### Create a container
```sh
$ docker container run entrypoint:v2
Hi, your ENTRYPOINT instruction in Shell Form !
```

Placed into *[run.sh](./run.sh)*.

##### Override the existing `ENTRYPOINT`
```sh
$ docker container run --entrypoint "/bin/echo" entrypoint:v2 "Hello, Welcome to Docker Meetup! "
Hello, Welcome to Docker Meetup!
```

Placed into *[override.sh](./override.sh)*.

## Utils / Trivia

### Exit the container shell
Press <kbd>Ctrl</kbd> + <kbd>c</kbd> to exit the container shell. This stops the running container.

If you want to detach from a container without stopping it, type <kbd>Ctrl</kbd> + <kbd>p</kbd> then <kbd>Ctrl</kbd> + <kbd>q</kbd>. It will help you to turn interactive mode to daemon mode.

## Troubleshooting

### Fix `permission denied` error
If you get the *permission denied* error while building the service scripts, make the script file executable:
```sh
$ chmod +x start
```

or:
```
$ chmod u+x clear
```

### Fix `failed to read dockerfile` error
If you get the *ERROR: failed to solve: failed to read dockerfile* error while running the service, probably you have your *Dockerfile* or other crucial static files missing. Run the *[create.sh](./create.sh)* script before executing the *start* command.
